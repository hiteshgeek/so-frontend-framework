// ============================================
// SIXORBIT UI - SCSS FUNCTIONS
// Utility functions for calculations and transformations
// ============================================

@use 'sass:math';
@use 'sass:color';
@use 'sass:string';
@use 'sass:list';
@use 'sass:map';
@use 'config' as *;
@use 'variables' as *;

// ============================================
// COLOR FUNCTIONS
// ============================================

/// Lighten a color by a percentage
/// @param {Color} $color - The color to lighten
/// @param {Number} $amount - The percentage to lighten (0-100)
/// @return {Color} - The lightened color
@function lighten-color($color, $amount: 10%) {
  @return color.scale($color, $lightness: $amount);
}

/// Darken a color by a percentage
/// @param {Color} $color - The color to darken
/// @param {Number} $amount - The percentage to darken (0-100)
/// @return {Color} - The darkened color
@function darken-color($color, $amount: 10%) {
  @return color.scale($color, $lightness: -$amount);
}

/// Add alpha/transparency to a color
/// @param {Color} $color - The color
/// @param {Number} $opacity - The opacity (0-1)
/// @return {Color} - The color with alpha
@function alpha($color, $opacity) {
  @return rgba($color, $opacity);
}

/// Get a hover color (slightly darker)
/// @param {Color} $color - The base color
/// @param {Number} $amount - The darkening amount
/// @return {Color} - The hover color
@function color-hover($color, $amount: 8%) {
  @return darken-color($color, $amount);
}

/// Get an active color (more darker)
/// @param {Color} $color - The base color
/// @param {Number} $amount - The darkening amount
/// @return {Color} - The active color
@function color-active($color, $amount: 12%) {
  @return darken-color($color, $amount);
}

/// Get a light background version of a color
/// @param {Color} $color - The base color
/// @param {Number} $opacity - The opacity (0-1)
/// @return {Color} - The light background color
@function color-light($color, $opacity: 0.1) {
  @return rgba($color, $opacity);
}

/// Get contrast color (black or white) based on background
/// @param {Color} $bg-color - The background color
/// @return {Color} - Black or white for best contrast
@function contrast-color($bg-color) {
  $r: color.red($bg-color);
  $g: color.green($bg-color);
  $b: color.blue($bg-color);
  $brightness: math.div(($r * 299 + $g * 587 + $b * 114), 1000);
  @if $brightness > 128 {
    @return #202124;
  } @else {
    @return #ffffff;
  }
}

/// Mix two colors
/// @param {Color} $color1 - First color
/// @param {Color} $color2 - Second color
/// @param {Number} $weight - Weight of first color (0-100%)
/// @return {Color} - The mixed color
@function mix-colors($color1, $color2, $weight: 50%) {
  @return color.mix($color1, $color2, $weight);
}

// ============================================
// SPACING FUNCTIONS
// ============================================

/// Calculate spacing based on multiplier
/// @param {Number} $multiplier - The multiplier
/// @return {Number} - The calculated spacing
@function space($multiplier) {
  @return $so-spacing-unit * $multiplier;
}

/// Negative spacing
/// @param {String} $key - Spacing key from map
/// @return {Number} - Negative spacing value
@function spacing-neg($key) {
  @return -1 * spacing($key);
}

// ============================================
// UNIT CONVERSION FUNCTIONS
// ============================================

/// Convert pixels to rem
/// @param {Number} $pixels - The pixel value
/// @param {Number} $base - Base font size (default 16px)
/// @return {Number} - The rem value
@function rem($pixels, $base: 16) {
  @if math.is-unitless($pixels) {
    @return math.div($pixels, $base) * 1rem;
  }
  @return math.div($pixels, $base * 1px) * 1rem;
}

/// Convert pixels to em
/// @param {Number} $pixels - The pixel value
/// @param {Number} $context - Context font size (default 16px)
/// @return {Number} - The em value
@function em($pixels, $context: 16) {
  @if math.is-unitless($pixels) {
    @return math.div($pixels, $context) * 1em;
  }
  @return math.div($pixels, $context * 1px) * 1em;
}

/// Strip unit from a number
/// @param {Number} $num - The number with unit
/// @return {Number} - The number without unit
@function strip-unit($num) {
  @return math.div($num, ($num * 0 + 1));
}

// ============================================
// STRING FUNCTIONS
// ============================================

/// Replace substring in string
/// @param {String} $string - The original string
/// @param {String} $search - The substring to search for
/// @param {String} $replace - The replacement string
/// @return {String} - The modified string
@function str-replace($string, $search, $replace: '') {
  $index: string.index($string, $search);

  @if $index {
    @return string.slice($string, 1, $index - 1) + $replace +
      str-replace(
        string.slice($string, $index + string.length($search)),
        $search,
        $replace
      );
  }

  @return $string;
}

/// Convert string to class name (add prefix)
/// @param {String} $name - The class name without prefix
/// @return {String} - The full class selector
@function class-name($name) {
  @return '.#{$so-prefix}#{$name}';
}

// ============================================
// LIST FUNCTIONS
// ============================================

/// Get first item from list
/// @param {List} $list - The list
/// @return {*} - The first item
@function first($list) {
  @return list.nth($list, 1);
}

/// Get last item from list
/// @param {List} $list - The list
/// @return {*} - The last item
@function last($list) {
  @return list.nth($list, list.length($list));
}

// ============================================
// MAP FUNCTIONS
// ============================================

/// Deep get from nested map
/// @param {Map} $map - The map
/// @param {Arglist} $keys - The keys path
/// @return {*} - The value
@function map-deep-get($map, $keys...) {
  @each $key in $keys {
    @if type-of($map) != 'map' {
      @return null;
    }
    $map: map.get($map, $key);
  }
  @return $map;
}

/// Check if map has key
/// @param {Map} $map - The map
/// @param {String} $key - The key to check
/// @return {Bool} - Whether the key exists
@function map-has($map, $key) {
  @return map.has-key($map, $key);
}

// ============================================
// MATH FUNCTIONS
// ============================================

/// Clamp a value between min and max
/// @param {Number} $value - The value to clamp
/// @param {Number} $min - Minimum value
/// @param {Number} $max - Maximum value
/// @return {Number} - The clamped value
@function clamp-value($value, $min, $max) {
  @return math.max($min, math.min($value, $max));
}

/// Calculate percentage
/// @param {Number} $value - The partial value
/// @param {Number} $total - The total value
/// @return {Number} - The percentage
@function percentage-of($value, $total) {
  @return math.percentage(math.div($value, $total));
}
