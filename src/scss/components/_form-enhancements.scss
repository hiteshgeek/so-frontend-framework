// ============================================
// SIXORBIT UI - FORM ENHANCEMENTS
// Input masking, password strength, char counter, clear button, prefix/suffix
// ============================================

@use '../abstracts' as *;

// ============================================
// INPUT MASKING VISUAL FEEDBACK
// ============================================

.#{$so-prefix}input-mask {
  font-family: $so-font-family-mono;
  letter-spacing: 0.5px;

  // Placeholder shows mask pattern
  &::placeholder {
    font-family: $so-font-family-mono;
    letter-spacing: 0.5px;
  }
}

// Mask format hint (shown below input)
.#{$so-prefix}mask-hint {
  font-size: font-size('xs');
  color: css-var('text-muted');
  font-family: $so-font-family-mono;
  margin-top: spacing('1');
}

// ============================================
// PASSWORD STRENGTH METER
// ============================================

.#{$so-prefix}password-wrapper {
  position: relative;

  // Only add extra padding if we have inline strength indicator
  &.#{$so-prefix}has-inline-strength .#{$so-prefix}form-control {
    padding-right: 88px; // Space for toggle + strength indicator
  }
}

// When password-wrapper is combined with input-wrapper, keep input-wrapper styles
.#{$so-prefix}input-wrapper.#{$so-prefix}password-wrapper {
  // Input action (toggle) should stay properly positioned
  .#{$so-prefix}input-action {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    z-index: 2;
  }

  // Ensure form control has proper padding for the action button
  .#{$so-prefix}form-control {
    padding-right: 44px;
  }
}

.#{$so-prefix}password-strength {
  display: flex;
  flex-direction: column;
  gap: spacing('1');
  margin-top: spacing('2');
}

.#{$so-prefix}password-strength-bar {
  display: flex;
  gap: 4px;
  height: 4px;
}

.#{$so-prefix}password-strength-segment {
  flex: 1;
  height: 100%;
  background: css-var('border-color');
  border-radius: radius('full');
  transition: background $so-transition-base;

  &.#{$so-prefix}active {
    &.#{$so-prefix}strength-weak {
      background: css-var('accent-danger');
    }

    &.#{$so-prefix}strength-fair {
      background: css-var('accent-warning');
    }

    &.#{$so-prefix}strength-good {
      background: css-var('accent-info');
    }

    &.#{$so-prefix}strength-strong {
      background: css-var('accent-success');
    }
  }
}

.#{$so-prefix}password-strength-text {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: font-size('xs');
  color: css-var('text-muted');
}

.#{$so-prefix}password-strength-label {
  font-weight: font-weight('medium');
  transition: color $so-transition-base;

  &.#{$so-prefix}strength-weak {
    color: css-var('accent-danger');
  }

  &.#{$so-prefix}strength-fair {
    color: css-var('accent-warning');
  }

  &.#{$so-prefix}strength-good {
    color: css-var('accent-info');
  }

  &.#{$so-prefix}strength-strong {
    color: css-var('accent-success');
  }
}

// Password requirements checklist
.#{$so-prefix}password-requirements {
  display: flex;
  flex-direction: column;
  gap: spacing('1');
  margin-top: spacing('2');
  padding: spacing('3');
  background: css-var('card-hover-bg');
  border-radius: radius('base');
}

.#{$so-prefix}password-requirement {
  display: flex;
  align-items: center;
  gap: spacing('2');
  font-size: font-size('sm');
  color: css-var('text-muted');
  transition: color $so-transition-base;

  .material-icons {
    font-size: 16px;
    color: css-var('text-muted');
    transition: color $so-transition-base;
  }

  &.#{$so-prefix}met {
    color: css-var('accent-success');

    .material-icons {
      color: css-var('accent-success');
    }
  }
}

// Inline strength indicator (in input wrapper)
.#{$so-prefix}password-strength-inline {
  position: absolute;
  right: 44px; // After toggle button
  top: 50%;
  transform: translateY(-50%);
  display: flex;
  gap: 2px;
  padding: spacing('1');
}

.#{$so-prefix}strength-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: css-var('border-color');
  transition: background $so-transition-base;

  &.#{$so-prefix}active {
    &.#{$so-prefix}strength-weak { background: css-var('accent-danger'); }
    &.#{$so-prefix}strength-fair { background: css-var('accent-warning'); }
    &.#{$so-prefix}strength-good { background: css-var('accent-info'); }
    &.#{$so-prefix}strength-strong { background: css-var('accent-success'); }
  }
}

// ============================================
// CHARACTER COUNTER
// ============================================

.#{$so-prefix}char-counter-wrapper {
  position: relative;
}

.#{$so-prefix}char-counter {
  display: flex;
  justify-content: flex-end;
  align-items: center;
  gap: spacing('1');
  margin-top: spacing('1');
  font-size: font-size('xs');
  color: css-var('text-muted');
  font-variant-numeric: tabular-nums;
  transition: color $so-transition-base;

  .material-icons {
    font-size: 14px;
  }

  // Warning state (near limit)
  &.#{$so-prefix}warning {
    color: css-var('accent-warning');
  }

  // Danger state (at or over limit)
  &.#{$so-prefix}danger {
    color: css-var('accent-danger');
  }

  // Success state (under limit)
  &.#{$so-prefix}success {
    color: css-var('accent-success');
  }
}

// Progress bar variant
.#{$so-prefix}char-counter-bar {
  display: flex;
  flex-direction: column;
  gap: spacing('1');
  margin-top: spacing('2');
}

.#{$so-prefix}char-counter-progress {
  height: 3px;
  background: css-var('border-color');
  border-radius: radius('full');
  overflow: hidden;
}

.#{$so-prefix}char-counter-fill {
  height: 100%;
  background: css-var('accent-primary');
  border-radius: radius('full');
  transition: width 0.2s ease, background $so-transition-base;

  &.#{$so-prefix}warning {
    background: css-var('accent-warning');
  }

  &.#{$so-prefix}danger {
    background: css-var('accent-danger');
  }
}

.#{$so-prefix}char-counter-text {
  display: flex;
  justify-content: space-between;
  font-size: font-size('xs');
  color: css-var('text-muted');
}

// Inline counter (inside input)
.#{$so-prefix}char-counter-inline {
  position: absolute;
  right: spacing('3');
  bottom: spacing('2');
  font-size: font-size('xs');
  color: css-var('text-muted');
  pointer-events: none;
  font-variant-numeric: tabular-nums;
  background: css-var('form-bg');
  padding: 0 spacing('1');
  border-radius: radius('sm');
}

// Textarea with inline counter needs extra padding
textarea.#{$so-prefix}form-control.#{$so-prefix}has-counter-inline {
  padding-bottom: spacing('6');
}

// ============================================
// CLEAR BUTTON (X Button to Clear Input)
// ============================================

.#{$so-prefix}input-clearable {
  position: relative;

  .#{$so-prefix}form-control {
    padding-right: 40px;
  }
}

.#{$so-prefix}input-clear-btn {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  display: none;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  padding: 0;
  margin: 0;
  background: css-var('card-hover-bg');
  border: none;
  border-radius: 50%;
  color: css-var('text-muted');
  cursor: pointer;
  transition: background $so-transition-base, color $so-transition-base, opacity $so-transition-base;
  opacity: 0.7;
  z-index: 2;

  .material-icons {
    font-size: 16px;
  }

  &:hover {
    background: css-var('border-color');
    color: css-var('text-primary');
    opacity: 1;
  }

  &:focus {
    outline: none;
    box-shadow: 0 0 0 2px alpha($so-primary, 0.3);
  }

  // Show when input has value
  .#{$so-prefix}input-clearable:focus-within &,
  .#{$so-prefix}form-control:not(:placeholder-shown) ~ & {
    display: flex;
  }

  // Also show when input has value attribute
  .#{$so-prefix}form-control[data-has-value="true"] ~ & {
    display: flex;
  }
}

// Clear button with icon on left
.#{$so-prefix}input-clearable.#{$so-prefix}has-icon {
  .#{$so-prefix}form-control {
    padding-left: 40px;
    padding-right: 40px;
  }
}

// Clear button with both icon and action
.#{$so-prefix}input-clearable.#{$so-prefix}has-action {
  .#{$so-prefix}form-control {
    padding-right: 72px;
  }

  .#{$so-prefix}input-clear-btn {
    right: 40px;
  }
}

// Size variants
.#{$so-prefix}input-clearable-sm {
  .#{$so-prefix}input-clear-btn {
    width: 20px;
    height: 20px;

    .material-icons {
      font-size: 14px;
    }
  }
}

.#{$so-prefix}input-clearable-lg {
  .#{$so-prefix}input-clear-btn {
    width: 28px;
    height: 28px;

    .material-icons {
      font-size: 18px;
    }
  }
}

// ============================================
// INPUT GROUP PREFIX/SUFFIX IMPROVEMENTS
// ============================================

// Enhanced addon with icon + text
.#{$so-prefix}input-addon {
  // Transparent variant
  &.#{$so-prefix}input-addon-transparent {
    background: transparent;
    border-color: transparent;
  }

  // Colored variants
  &.#{$so-prefix}input-addon-primary {
    background: alpha($so-primary, 0.1);
    color: css-var('accent-primary');
    border-color: css-var('accent-primary');
  }

  &.#{$so-prefix}input-addon-success {
    background: alpha($so-success, 0.1);
    color: css-var('accent-success');
    border-color: css-var('accent-success');
  }

  &.#{$so-prefix}input-addon-danger {
    background: alpha($so-danger, 0.1);
    color: css-var('accent-danger');
    border-color: css-var('accent-danger');
  }

  &.#{$so-prefix}input-addon-warning {
    background: alpha($so-warning, 0.1);
    color: css-var('accent-warning');
    border-color: css-var('accent-warning');
  }

  &.#{$so-prefix}input-addon-info {
    background: alpha($so-info, 0.1);
    color: css-var('accent-info');
    border-color: css-var('accent-info');
  }

  // Compact addon (less padding)
  &.#{$so-prefix}input-addon-compact {
    padding: 0 spacing('2');
  }

  // Wide addon (more padding)
  &.#{$so-prefix}input-addon-wide {
    padding: 0 spacing('4');
    min-width: 60px;
    justify-content: center;
  }

  // Clickable addon
  &.#{$so-prefix}input-addon-clickable {
    cursor: pointer;
    transition: background $so-transition-base, color $so-transition-base;

    &:hover {
      background: css-var('card-hover-bg');
      color: css-var('text-primary');
    }

    &:active {
      background: css-var('border-color');
    }
  }

  // Dropdown addon
  &.#{$so-prefix}input-addon-dropdown {
    cursor: pointer;
    gap: spacing('1');

    &::after {
      content: '';
      border: 4px solid transparent;
      border-top-color: currentColor;
      margin-left: spacing('1');
    }
  }
}

// Input with prefix text
.#{$so-prefix}input-prefix {
  position: relative;

  .#{$so-prefix}prefix-text {
    position: absolute;
    left: spacing('3');
    top: 50%;
    transform: translateY(-50%);
    color: css-var('text-muted');
    font-size: font-size('base');
    pointer-events: none;
    z-index: 1;
  }

  .#{$so-prefix}form-control {
    padding-left: var(--so-prefix-width, 60px);
  }
}

// Input with suffix text
.#{$so-prefix}input-suffix {
  position: relative;

  .#{$so-prefix}suffix-text {
    position: absolute;
    right: spacing('3');
    top: 50%;
    transform: translateY(-50%);
    color: css-var('text-muted');
    font-size: font-size('base');
    pointer-events: none;
    z-index: 1;
  }

  .#{$so-prefix}form-control {
    padding-right: var(--so-suffix-width, 60px);
  }
}

// Combined prefix and suffix
.#{$so-prefix}input-prefix.#{$so-prefix}input-suffix {
  .#{$so-prefix}form-control {
    padding-left: var(--so-prefix-width, 60px);
    padding-right: var(--so-suffix-width, 60px);
  }
}

// Currency input preset
.#{$so-prefix}input-currency {
  .#{$so-prefix}prefix-text {
    font-weight: font-weight('medium');
  }

  .#{$so-prefix}form-control {
    font-variant-numeric: tabular-nums;
    text-align: right;
  }
}

// Percentage input preset
.#{$so-prefix}input-percentage {
  .#{$so-prefix}form-control {
    font-variant-numeric: tabular-nums;
    text-align: right;
    padding-right: 40px;
  }

  .#{$so-prefix}suffix-text {
    font-weight: font-weight('medium');
  }
}

// URL input preset
.#{$so-prefix}input-url {
  .#{$so-prefix}prefix-text {
    font-size: font-size('sm');
    color: css-var('text-secondary');
  }
}

// ============================================
// INPUT WITH SPINNER (Loading State)
// ============================================

.#{$so-prefix}input-loading {
  position: relative;
  pointer-events: none;

  .#{$so-prefix}form-control {
    padding-right: 40px;
    color: css-var('text-muted');
  }

  &::after {
    content: '';
    position: absolute;
    right: 12px;
    top: 50%;
    width: 16px;
    height: 16px;
    margin-top: -8px;
    border: 2px solid css-var('border-color');
    border-top-color: css-var('accent-primary');
    border-radius: 50%;
    animation: so-input-spin 0.6s linear infinite;
  }
}

@keyframes so-input-spin {
  to { transform: rotate(360deg); }
}

// ============================================
// INPUT VALIDATION ICONS
// ============================================

.#{$so-prefix}input-validated {
  position: relative;

  .#{$so-prefix}form-control {
    padding-right: 40px;
  }

  .#{$so-prefix}validation-icon {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none;

    .material-icons {
      font-size: 20px;
    }
  }

  &.#{$so-prefix}is-valid .#{$so-prefix}validation-icon {
    color: css-var('accent-success');
  }

  &.#{$so-prefix}is-invalid .#{$so-prefix}validation-icon {
    color: css-var('accent-danger');
  }

  &.#{$so-prefix}is-warning .#{$so-prefix}validation-icon {
    color: css-var('accent-warning');
  }
}

// ============================================
// RESPONSIVE ADJUSTMENTS
// ============================================

@media (max-width: 576px) {
  .#{$so-prefix}password-strength-inline {
    display: none;
  }

  .#{$so-prefix}char-counter-inline {
    font-size: 10px;
    padding: 0 2px;
  }
}
