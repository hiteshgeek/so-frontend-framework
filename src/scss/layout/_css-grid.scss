// ============================================
// SIXORBIT UI - CSS GRID SYSTEM
// Modern CSS Grid alternative to flexbox
// ============================================

@use 'sass:map';
@use 'sass:math';
@use '../abstracts' as *;
@use 'grid-config' as config;

// ============================================
// CSS GRID CONTAINER
// ============================================

.#{$so-prefix}grid {
  display: grid;
  grid-template-columns: repeat(#{config.$grid-columns}, 1fr);
  gap: var(--#{$so-css-var-prefix}-grid-gap, 1.5rem);
}

// Grid with auto columns (auto-fit/auto-fill)
.#{$so-prefix}grid-auto {
  display: grid;
  gap: var(--#{$so-css-var-prefix}-grid-gap, 1.5rem);
}

// Auto-fit: columns shrink to fit
.#{$so-prefix}grid-auto-fit {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(var(--#{$so-css-var-prefix}-grid-min-col, 250px), 1fr));
  gap: var(--#{$so-css-var-prefix}-grid-gap, 1.5rem);
}

// Auto-fill: columns maintain size, may have empty space
.#{$so-prefix}grid-auto-fill {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(var(--#{$so-css-var-prefix}-grid-min-col, 250px), 1fr));
  gap: var(--#{$so-css-var-prefix}-grid-gap, 1.5rem);
}

// ============================================
// COLUMN SPAN CLASSES
// ============================================

/// Generate column span classes
/// @param {String} $breakpoint - Breakpoint infix
@mixin make-col-spans($breakpoint: '') {
  $infix: '';
  @if $breakpoint != '' {
    $infix: '-#{$breakpoint}';
  }

  @for $i from 1 through config.$grid-columns {
    .#{$so-prefix}col-span#{$infix}-#{$i} {
      grid-column: span #{$i};
    }
  }

  // Full width
  .#{$so-prefix}col-span#{$infix}-full {
    grid-column: 1 / -1;
  }

  // Auto
  .#{$so-prefix}col-span#{$infix}-auto {
    grid-column: auto;
  }
}

/// Generate row span classes
/// @param {String} $breakpoint - Breakpoint infix
@mixin make-row-spans($breakpoint: '') {
  $infix: '';
  @if $breakpoint != '' {
    $infix: '-#{$breakpoint}';
  }

  @for $i from 1 through 6 {
    .#{$so-prefix}row-span#{$infix}-#{$i} {
      grid-row: span #{$i};
    }
  }

  // Full height
  .#{$so-prefix}row-span#{$infix}-full {
    grid-row: 1 / -1;
  }
}

/// Generate column start/end classes
/// @param {String} $breakpoint - Breakpoint infix
@mixin make-col-positions($breakpoint: '') {
  $infix: '';
  @if $breakpoint != '' {
    $infix: '-#{$breakpoint}';
  }

  @for $i from 1 through (config.$grid-columns + 1) {
    .#{$so-prefix}col-start#{$infix}-#{$i} {
      grid-column-start: $i;
    }

    .#{$so-prefix}col-end#{$infix}-#{$i} {
      grid-column-end: $i;
    }
  }

  // Auto positioning
  .#{$so-prefix}col-start#{$infix}-auto {
    grid-column-start: auto;
  }

  .#{$so-prefix}col-end#{$infix}-auto {
    grid-column-end: auto;
  }
}

/// Generate row start/end classes
/// @param {String} $breakpoint - Breakpoint infix
@mixin make-row-positions($breakpoint: '') {
  $infix: '';
  @if $breakpoint != '' {
    $infix: '-#{$breakpoint}';
  }

  @for $i from 1 through 7 {
    .#{$so-prefix}row-start#{$infix}-#{$i} {
      grid-row-start: $i;
    }

    .#{$so-prefix}row-end#{$infix}-#{$i} {
      grid-row-end: $i;
    }
  }

  // Auto positioning
  .#{$so-prefix}row-start#{$infix}-auto {
    grid-row-start: auto;
  }

  .#{$so-prefix}row-end#{$infix}-auto {
    grid-row-end: auto;
  }
}

// ============================================
// BASE CLASSES (NO BREAKPOINT)
// ============================================

@include make-col-spans();
@include make-row-spans();
@include make-col-positions();
@include make-row-positions();

// ============================================
// RESPONSIVE CLASSES
// ============================================

@each $breakpoint, $min-width in config.$grid-breakpoints {
  @if $breakpoint != 'xs' {
    @media (min-width: $min-width) {
      @include make-col-spans($breakpoint);
      @include make-row-spans($breakpoint);
      @include make-col-positions($breakpoint);
      @include make-row-positions($breakpoint);
    }
  }
}

// ============================================
// GRID TEMPLATE COLUMNS UTILITIES
// ============================================

@for $i from 1 through config.$grid-columns {
  .#{$so-prefix}grid-cols-#{$i} {
    grid-template-columns: repeat(#{$i}, minmax(0, 1fr));
  }
}

.#{$so-prefix}grid-cols-none {
  grid-template-columns: none;
}

// Responsive grid-cols
@each $breakpoint, $min-width in config.$grid-breakpoints {
  @if $breakpoint != 'xs' {
    @media (min-width: $min-width) {
      @for $i from 1 through config.$grid-columns {
        .#{$so-prefix}grid-cols-#{$breakpoint}-#{$i} {
          grid-template-columns: repeat(#{$i}, minmax(0, 1fr));
        }
      }

      .#{$so-prefix}grid-cols-#{$breakpoint}-none {
        grid-template-columns: none;
      }
    }
  }
}

// ============================================
// GRID TEMPLATE ROWS UTILITIES
// ============================================

@for $i from 1 through 6 {
  .#{$so-prefix}grid-rows-#{$i} {
    grid-template-rows: repeat(#{$i}, minmax(0, 1fr));
  }
}

.#{$so-prefix}grid-rows-none {
  grid-template-rows: none;
}

// Responsive grid-rows
@each $breakpoint, $min-width in config.$grid-breakpoints {
  @if $breakpoint != 'xs' {
    @media (min-width: $min-width) {
      @for $i from 1 through 6 {
        .#{$so-prefix}grid-rows-#{$breakpoint}-#{$i} {
          grid-template-rows: repeat(#{$i}, minmax(0, 1fr));
        }
      }
    }
  }
}

// ============================================
// GRID GAP UTILITIES
// ============================================

@each $size, $value in config.$grid-gap-sizes {
  .#{$so-prefix}grid-gap-#{$size} {
    gap: $value;
  }

  .#{$so-prefix}grid-gap-x-#{$size} {
    column-gap: $value;
  }

  .#{$so-prefix}grid-gap-y-#{$size} {
    row-gap: $value;
  }
}

// Responsive gap
@each $breakpoint, $min-width in config.$grid-breakpoints {
  @if $breakpoint != 'xs' {
    @media (min-width: $min-width) {
      @each $size, $value in config.$grid-gap-sizes {
        .#{$so-prefix}grid-gap-#{$breakpoint}-#{$size} {
          gap: $value;
        }

        .#{$so-prefix}grid-gap-x-#{$breakpoint}-#{$size} {
          column-gap: $value;
        }

        .#{$so-prefix}grid-gap-y-#{$breakpoint}-#{$size} {
          row-gap: $value;
        }
      }
    }
  }
}

// ============================================
// GRID FLOW UTILITIES
// ============================================

.#{$so-prefix}grid-flow-row {
  grid-auto-flow: row;
}

.#{$so-prefix}grid-flow-col {
  grid-auto-flow: column;
}

.#{$so-prefix}grid-flow-dense {
  grid-auto-flow: dense;
}

.#{$so-prefix}grid-flow-row-dense {
  grid-auto-flow: row dense;
}

.#{$so-prefix}grid-flow-col-dense {
  grid-auto-flow: column dense;
}

// ============================================
// PLACE ITEMS / PLACE CONTENT / PLACE SELF
// ============================================

// Place items (align-items + justify-items)
$place-values: (start, end, center, stretch);

@each $value in $place-values {
  .#{$so-prefix}place-items-#{$value} {
    place-items: $value;
  }

  .#{$so-prefix}place-content-#{$value} {
    place-content: $value;
  }

  .#{$so-prefix}place-self-#{$value} {
    place-self: $value;
  }

  .#{$so-prefix}justify-items-#{$value} {
    justify-items: $value;
  }
}

// Additional place-content values
.#{$so-prefix}place-content-between {
  place-content: space-between;
}

.#{$so-prefix}place-content-around {
  place-content: space-around;
}

.#{$so-prefix}place-content-evenly {
  place-content: space-evenly;
}

// ============================================
// SUBGRID SUPPORT (Modern Browsers)
// ============================================

.#{$so-prefix}subgrid {
  display: grid;
  grid-template-columns: subgrid;
}

.#{$so-prefix}subgrid-rows {
  display: grid;
  grid-template-rows: subgrid;
}

.#{$so-prefix}subgrid-both {
  display: grid;
  grid-template-columns: subgrid;
  grid-template-rows: subgrid;
}

// ============================================
// GRID TEMPLATE AREAS UTILITIES
// ============================================

// Usage: style="--so-grid-areas: 'header header' 'sidebar main' 'footer footer'"
.#{$so-prefix}grid-areas {
  grid-template-areas: var(--#{$so-css-var-prefix}-grid-areas);
}

// Grid area assignment utilities
.#{$so-prefix}area-auto {
  grid-area: auto;
}

// ============================================
// AUTO COLUMNS / AUTO ROWS
// ============================================

.#{$so-prefix}auto-cols-auto {
  grid-auto-columns: auto;
}

.#{$so-prefix}auto-cols-min {
  grid-auto-columns: min-content;
}

.#{$so-prefix}auto-cols-max {
  grid-auto-columns: max-content;
}

.#{$so-prefix}auto-cols-fr {
  grid-auto-columns: minmax(0, 1fr);
}

.#{$so-prefix}auto-rows-auto {
  grid-auto-rows: auto;
}

.#{$so-prefix}auto-rows-min {
  grid-auto-rows: min-content;
}

.#{$so-prefix}auto-rows-max {
  grid-auto-rows: max-content;
}

.#{$so-prefix}auto-rows-fr {
  grid-auto-rows: minmax(0, 1fr);
}

// ============================================
// RESPONSIVE GUTTER SCALING
// ============================================

// Automatically scale gutters based on viewport
.#{$so-prefix}grid-responsive-gap {
  --#{$so-css-var-prefix}-grid-gap: 0.75rem;

  @media (min-width: 576px) {
    --#{$so-css-var-prefix}-grid-gap: 1rem;
  }

  @media (min-width: 768px) {
    --#{$so-css-var-prefix}-grid-gap: 1.25rem;
  }

  @media (min-width: 992px) {
    --#{$so-css-var-prefix}-grid-gap: 1.5rem;
  }

  @media (min-width: 1200px) {
    --#{$so-css-var-prefix}-grid-gap: 2rem;
  }
}

// ============================================
// COMMON GRID LAYOUTS (PRESETS)
// ============================================

// Holy grail layout
.#{$so-prefix}grid-holy-grail {
  display: grid;
  grid-template-areas:
    'header header header'
    'nav main aside'
    'footer footer footer';
  grid-template-columns: 200px 1fr 200px;
  grid-template-rows: auto 1fr auto;
  min-height: 100vh;
  gap: var(--#{$so-css-var-prefix}-grid-gap, 1rem);

  @media (max-width: 768px) {
    grid-template-areas:
      'header'
      'nav'
      'main'
      'aside'
      'footer';
    grid-template-columns: 1fr;
    grid-template-rows: auto;
  }
}

// Sidebar layout
.#{$so-prefix}grid-sidebar {
  display: grid;
  grid-template-columns: 250px 1fr;
  gap: var(--#{$so-css-var-prefix}-grid-gap, 1.5rem);

  @media (max-width: 768px) {
    grid-template-columns: 1fr;
  }
}

// Sidebar right layout
.#{$so-prefix}grid-sidebar-right {
  display: grid;
  grid-template-columns: 1fr 250px;
  gap: var(--#{$so-css-var-prefix}-grid-gap, 1.5rem);

  @media (max-width: 768px) {
    grid-template-columns: 1fr;
  }
}

// Dashboard layout (common card grid)
.#{$so-prefix}grid-dashboard {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: var(--#{$so-css-var-prefix}-grid-gap, 1.5rem);
}

// Masonry-like layout (using CSS Grid dense packing)
.#{$so-prefix}grid-masonry {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  grid-auto-rows: 10px;
  gap: var(--#{$so-css-var-prefix}-grid-gap, 1rem);
  grid-auto-flow: dense;
}
